<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://localhost:8000/style">
    <!-- <link rel="stylesheet" href="http://localhost:8000/bootstrapstyle"> -->

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- <script src="http://localhost:8000/bootstrapjs"></script> -->

    <title>Document</title>
</head>

<body>
    <div class="body">
        <!--Begin navbar-->
        <div class="navbar-wrapper">
            <div class="container">

                <nav class="navbar navbar-inverse navbar-static-top">
                    <div class="container">
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false"
                                aria-controls="navbar">
                                <span class="sr-only">Toggle navigation</span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                            <a class="navbar-brand brand" href="#">Bulletin System</a>
                        </div>
                        <div id="navbar" class="navbar-collapse collapse">

                            <ul class="nav navbar-nav">
                                <li><a href="#registration" id="registrationLink">Regstration</a></li>
                                <li><a href="#login" id="loginLink">Login</a></li>
                                <li class="dropdown">
                                    <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Link Management<span class="caret"></span></a>
                                    <ul class="dropdown-menu">
                                        <li id="homeDashboard"><a href="#home-dashboard">Home</a></li>
                                        <li id="bulletinDashboard"><a href="#bulletins-dashboard">Campaign Dashboard</a></li>
                                        <li role="separator" class="divider"></li>
                                        <li id="trackLinks"><a href="#track-links">Track links</a></li>
                                        <li role="separator" class="divider"></li>

                                        <li id="addLink" style="display:none"><a href="#add-link" data-toggle="modal" data-target="#linkModal" data-whatever="@mdo">Add Link</a></li>
                                        <li role="separator" class="divider" id="separatorAfter" style="display:none"></li>
                                        <li id="addCampaignLink"><a href="#add-campaign">Add Campaign</a></li>
                                    </ul>
                                </li>
                                <li id="testPageLink"><a href="#testPage">Test Page</a></li>
                                <li id="tasksLink"><a href="#tasks"></a></li>
                                <!-- <li id="chatLink"><a href="#chat" data-toggle="modal" data-target="#linkModal" data-whatever="@mdo">Chat  <span class="badge"></span></a></li> -->
                                <li id="logoutLink"><a href="#logout">Logout</a></li>
                                <li id="userLoggedIn"><a href=""></a></li>

                            </ul>
                        </div>
                    </div>
                </nav>
                <!-- <img src="" alt="" class="imgHomePage" id="imgHomePage"></div> -->
            </div>
            <div class="container">
                <img src="http://socialvani.com/wp-content/uploads/2017/03/Tracking-Links.jpg" class="container" id="mainBoard" alt="">
            </div>
            <!--End navbar-->
            <div id="wrapper">
                <div class="container" id="head">
                    <p id="imgHomePage" class=""></p>
                    <h1 id="pageTitle" class="pageTitle"></h1>
                </div>

                <div id="bodyControls" class="container bodyControls"></div>
                <div id="imgTag" class="container"></div>
                <div class="container" id="selectBulletins" style="display:none">
                    <select class="form-control" name="campaignName" id="campaignName">
                        <option value="0" selected>Select Bulletin</option>
                    </select>
                </div>
                <div id="bodyContainer" class="container"></div>
                <!--Register form begin-->
                <div class="container">
                    <div class="login" id="register">

                        <form class="form-signin" id="registerForm">
                            <h1>Registration Page</h1>
                            <h3 class="form-signin-heading">Please sign in</h3>
                            <label for="inputFirstName" class="sr-only">First name</label>
                            <input type="text" id="inputFirstNameReg" class="form-control" placeholder="First Name" required autofocus>

                            <label for="inputLastNAme" class="sr-only">Last Name</label>
                            <input type="text" id="inputLastNameReg" class="form-control" placeholder="Last Name" required autofocus>

                            <label for="inputEmail" class="sr-only">Email address</label>
                            <input type="email" id="inputEmailReg" class="form-control" placeholder="Email address" required autofocus>

                            <label for="inputPassword" class="sr-only">Password</label>
                            <input type="password" id="inputPasswordReg" class="form-control" placeholder="Password" required>

                            <label for="selectClient" class="sr-only">Select client</label>
                            <select name="clients" id="clients" class="form-control" placeholder="Last Name">
                                  <option value="0">Select client</option>
                            </select>

                            <p><button class="btn btn-lg btn-primary btn-block" id="btnRegister" type="submit">Sign in</button>                                </p>
                            <div id="alertRegister" class="alert alert-danger" role="alert">
                                This is a danger alert—check it out!
                            </div>
                        </form>
                    </div>
                </div>
                <!--Register form end-->

                <!--Login form begin-->
                <div class="container">
                    <div class="login" id="login">

                        <form class="form-signin" id="loginForm">
                            <h1>Login Page</h1>
                            <h3 class="form-signin-heading">Please login</h3>

                            <label for="inputEmail" class="sr-only">Email address</label>
                            <input type="email" id="inputEmail" class="form-control" placeholder="Email address" required autofocus>

                            <label for="inputPassword" class="sr-only">Password</label>
                            <input type="password" id="inputPassword" class="form-control" placeholder="Password" required>

                            <label for="inputPassword" class="sr-only">Assign to client</label>

                            <p><button class="btn btn-lg btn-primary btn-block" id="btnLogin" type="submit">Sign in</button></p>
                            <div id="alertLogin" class="alert alert-danger" role="alert">
                                This is a danger alert—check it out!
                            </div>
                        </form>

                    </div>
                </div>
                <!--Login form end-->

                <!--Add campaign form start-->
                <div id="campaignDashboard" class="container" style="display:none">
                    <!-- <div id="userLoggedIn" class="alert alert-info" role="alert">
                    This is a danger alert—check it out!
                </div> -->

                    <ul class="list-group" id="addCampaign">

                        <li class="list-group-item" id="newCampaign">
                            <div class="card border-success mb-3" style="max-width: 40rem;">
                                <div class="card-header bg-transparent border-info"><small id="emailHelp" class="form-text text-muted">Campaign details</small></div>
                                <div class="card-body text-success">
                                    <form action="" id="formCampaign">

                                        <div class="form-group">
                                            <label for="exampleInputEmail1">Campaign title</label>
                                            <input type="text" class="form-control" id="campaignTitleInput" aria-describedby="emailHelp" placeholder="Campaign title">
                                        </div>
                                        <div class="form-group">
                                            <label for="exampleInputEmail1">Campaign type</label>
                                            <input type="text" class="form-control" id="campaignTypeInput" aria-describedby="emailHelp" placeholder="Campaign type">
                                        </div>

                                        <div class="form-group">
                                            <label for="exampleInputEmail1">Campaign description</label>
                                            <textarea name="campaignDescriptionInput" cols="30" rows="10" class="form-control" id="campaignDescriptionInput" aria-describedby="emailHelp"
                                                placeholder="Campaign description"></textarea>
                                            <label for="exampleInputEmail1">Start Date</label>
                                            <input type="date" class="form-control" id="startDateInput" aria-describedby="emailHelp" placeholder="Stard Date">
                                            <label for="exampleInputEmail1">End Date</label>
                                            <input type="date" class="form-control" id="endDateInput" aria-describedby="emailHelp" placeholder="End Date">
                                            <label for="exampleInputEmail1">Date to send bulletin</label>
                                            <input type="date" class="form-control" id="sendDateInput" aria-describedby="emailHelp" placeholder="Send bulletin">
                                            <label for="exampleInputEmail1">Send copies</label>
                                            <input type="number" class="form-control" id="sendCopies" aria-describedby="emailHelp" placeholder="Send copies" min=0>

                                            <div class="card-footer bg-transparent border-info">
                                                <button type="button" class="btn btn-secondary saveBtn" id="saveCampaign" style="margin:15px; width:120px;">Save</button>
                                                <button type="button" class="btn btn-secondary saveBtn" id="editCampaign" style="margin:15px; width:120px;">Save changes</button>
                                                <button type="button" class="btn btn-secondary" id="closeCampaign" style="margin:15px; width:120px;">Close</button>
                                            </div>

                                            <div id="alertInsertCampaign" class="alert alert-danger" role="alert" style="display:none">
                                                This is a danger alert—check it out!
                                            </div>
                                        </div>

                                    </form>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
                <!--Add campaign form end-->
                <div class="afterLoginBoard container" id="afterLoginBoard">
                    <!-- <div class="navigationBtn border" id="linksLoad"><h4>Track Links</h4><a href="#track-links"><img  class="navigationBtn border" src="https://getsocial.ru/template/files/uploads/image/template/files/uploads/f/backlinks.gif" alt=""></a></div>
                    <div class="navigationBtn border" id="bulletinsLoad"><h4>Bulletins</h4><a href="#bulletins-dashboard"><img class="navigationBtn border" src="http://nonprofitorgs.files.wordpress.com/2011/09/socialmedia3.jpg" alt=""></a></div> -->
                </div>
                <!--ProjectSections start-->
                <div class="container">
                    <a id="csvDownload" href="" download="tasks.csv" style="display:none"><button >Save as CSV</button></a>
                    <!-- <div id="project_board" class="projectBoard">
                    <div class="section-container" id="sectionDefaultPrim" style="display:block" ondrop="drop(event)" ondragover="allowDrop(event)">
                        <ul class="section" id="tasksPrim">
                            <!--template for one section-start-->
                    <!-- <li>
                                <h4 id="section_headPrim" class="sectionHead"> Section Generator</h4>
                            </li>
                            <li>
                                <hr style="width: 20rem; float:left;"><br>
                            </li>
                            <li id="cardDefaultPrim" draggable="true" ondragstart="drag(event)">
                                <div class="card" style="width: 20rem;">
                                    <div class="card">
                                        <label id="btnStatusPrim" class="btn  taskStatus" style=" width: 20rem; float:left;">Status</label>
                                        <h4 class="card-title" id="taskTitlePrim" style="width: 20rem;">Special title treatment </h4>
                                        <p class="card-body" id="taskDescriptionPrim" style="width: 20rem;">With supporting text below as a natural lead-in to additional content.</p>
                                        <button type="button" id="viewTaskOpenPrim" class="btn btn-default" data-toggle="modal" data-target="#exampleModal" data-whatever="@mdo">View Task</button>
                                    </div>
                                </div>
                            </li> -->
                    <!--template for one section- end-->
                    <!-- <li>
                        <div class="card" style="width: 20rem;">
                            <div class="card-body">
                                <h4 class="card-title">Special title treatment</h4>
                                <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
                                <a href="#" class="btn btn-primary">View Task</a>
                            </div>
                        </div>
                    </li> -->
                    <!-- <li>
                                <hr style="width: 20rem; float:left">
                            </li>
                            <li> <button type="button" id="newSectionPrim" class="btn btn-default large">New Section</button>
                                <button type="button" id="newTaskOpenPrim" class="btn btn-primary" data-toggle="modal" data-target="#newTask" data-whatever="@mdo">New Task</button>
                            </li>
                            <li> <input type="text" id="newSectionTitlePrim" class="form-group"><button type="button" id="addSectionPrim"
                                    class="btn btn-primary larger" class="form-group">Add</button></li>
                            <li>
                                <div id="alertCreateSectionPrim" class="alert alert-danger" role="alert" style="margin-right: 30px;">
                                    This is a danger alert—check it out!
                                </div>
                            </li>
                            <li>
                                <hr style="width: 20rem; float:left;">
                            </li>
                        </ul>
                    </div> -->

                    <!-- </div> -->
                </div>

                <!--Display test form-->
                <div id="testPage" class="container" width="100" height="100" style="border:1px solid black; display:none">
                </div>
                <!--Display test form end-->

                <!--Modal for New link-->
                <div class="modal fade" id="linkModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4>New Link details</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            </div>
                            <div class="modal-body">
                                <form id="formAddLink">
                                    <div class="form-group">
                                        <label for="">Target link</label>
                                        <input type="text" class="form-control" id="targetLinkInput">
                                    </div>
                                    <div class="form-group">
                                        <label for="message-text" class="form-control-label">Description</label>
                                        <input class="form-control" data-commentId="" id="linkDescriptionInput"></input>
                                    </div>
                                    <div class="form-group" id="selectBulletinDiv">
                                        <!-- <button class="btn default" id="showBulletin">Change bulletin</button>
                                        <select class="form-control" id="selectChangeBulletin" style="display:none">
                                            <option value="0">Select Bulletin</option>
                                        </select> -->
                                    </div>

                            </div>
                            <div class="modal-footer">
                                <ul>
                                    <li><button type="button" class="btn btn-secondary btns" id="closeLink" data-dismiss="modal">Close</button></li>
                                    <li><button type="button" class="btn btn-primary btns saveBtn" id="saveLink">Save</button></li>
                                    <li><button type="button" class="btn btn-primary btns saveBtn" id="editLink">Save changes</button></li>
                                </ul>
                                <div id="alertInsertLink" class="alert alert-danger" role="alert" style="margin-right: 30px;display:none">
                                    This is a danger alert—check it out!
                                </div>
                            </div>
                            </form>

                        </div>
                    </div>
                </div>
                <!--Modal for New link end-->

                <!--Modal for chat -->
                <div class="modal fade" id="chatModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">

                            <div class="modal-body">
                                <form>
                                    <div id="allChatComments">
                                        <div class="form-group" id="chat">
                                            <label for="recipient-name" class="form-control-label" style="font-style:oblique" id="commentBy">Commented by:</label>
                                            <input type="text" class="form-control" id="commentId" readonly>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="message-text" class="form-control-label">Comment:</label>
                                        <textarea class="form-control" id="comment"></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="button" id="sendComment" class="btn btn-primary">Send message</button>
                            </div>
                        </div>

                    </div>
                </div>
                <!--End modal for chat-->
            </div>
            <!--wrapper-->
            <div id="alertMessage" class="alert alert-warning" role="alert" style="display: none">
                This is a danger alert—check it out!
            </div>
            <!-- <img src="https://cdn3.iconfinder.com/data/icons/beach-and-vacation-icons/512/Surfing-512.png" style="width:60; height:60"/> -->
            <div class="container">
                <a id="download" download="chart.png" style="display:none"><button type="button" onClick="download()">Download</button></a>
                <canvas id="canvas" class="border" style="display:none; background-color:white"></canvas>
            </div>
        </div>
        <!--ProjectSections end-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.2/socket.io.js"></script>
        <script>
            const BASE_URL = window.location.origin;
            // console.log(BASE_URL);
            //const BASE_URL = "https://localhost:8000";
            const HELP = BASE_URL + "/help";
            const HOME = BASE_URL + "/home";
            const REGISTRATION = BASE_URL + "/registration";
            const LOGIN = BASE_URL + "/login";
            const BULLETIN_DASHBOARD = BASE_URL + "/bulletinDashboard";
            const LOGOUT = BASE_URL + "/logout";
            const TEMPLATE = BASE_URL + "/template";
            const LINKS = BASE_URL + "/linksDashboard";
            const CAMPAIGN = BASE_URL + "/addCampaign";
            const NEWLINK = BASE_URL + "/addLink";
            const ONLINESTATUS = BASE_URL + "/online";
            const PAGINATION = BASE_URL + "/pagination";
            const CACHE = BASE_URL + "/cache";
            const INDEXEDDB = BASE_URL + "/indexeddb";

            //const TESTPAGE = BASE_URL + "/testpage";
            //const TESTHTML = BASE_URL + "/testhtml";
            const IMG = BASE_URL + "/img";
            const SW = BASE_URL + "/sw";
            const WEBSQL = BASE_URL + "/websql";

            var routes = [HELP, HOME, IMG, SW, WEBSQL, CACHE, INDEXEDDB, PAGINATION, REGISTRATION, LOGIN, BULLETIN_DASHBOARD, LOGOUT, TEMPLATE, LINKS, CAMPAIGN, NEWLINK, ONLINESTATUS];

            for (var i = 0; i < routes.length - 1; i++) {

                var script = document.createElement('script');
                script.src = routes[i];
                document.body.appendChild(script);
            }
        </script>
        <script>
            var isOnline = true;
            var userOffline;

            function checkOnlineStatus() {

                var status = (navigator.onLine) ? true : false;
                console.log(navigator.onLine)
                return status;
            }

            isOnline = checkOnlineStatus();

            function serviceWorkerRegister() {
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register(SW).then(function (registration) {
                        console.log('[ServiceWorker] registered for caching');
                    }).catch(function (err) {
                        console.log('[ServiceWorker] Registration error', err);
                    });
                } else {
                    console.log('[ServiceWorker] not supported');
                }
            };
            serviceWorkerRegister();

            window.addEventListener('online', function () {
                isOnline = checkOnlineStatus();
                var d = document.getElementById('alertMessage');

                if (true === checkOnlineStatus()) {

                    var user = JSON.parse(localStorage.getItem('user'));
                    user.role = localStorage.getItem('role');
                    localStorage.setItem('user', JSON.stringify(user));

                    document.getElementById('trackLinks').click();
                    document.getElementById('bulletinDashboard').click();
                    d.innerText = 'You are Online';
                    d.style.display = 'block';
                    // refreshData('bulletins', bulletinData);
                    // refreshData('tracklinks', linkData);

                    console.log('Online document ', document);
                } else {
                    d.style.display = 'none';
                }
            });
            // https://cdn3.iconfinder.com/data/icons/beach-and-vacation-icons/512/Surfing-512.png
            window.addEventListener('offline', function () {

                isOnline = checkOnlineStatus();
                var d = document.getElementById('alertMessage');


                document.getElementById('trackLinks').click();
                document.getElementById('bulletinDashboard').click();

                if (false === checkOnlineStatus()) {

                    var role = JSON.parse(localStorage.getItem('user')).role;
                    var user = JSON.parse(localStorage.getItem('user'));
                    console.log(user);
                    user.role = 0;
                    localStorage.setItem('user', JSON.stringify(user));

                    console.log('OFFline document ', document);
                    d.innerHTML = 'OFFLINE surfing. Data changes will be temporary unavailable <span><img src="https://cdn3.iconfinder.com/data/icons/beach-and-vacation-icons/512/Surfing-512.png"/ class="offlineImg" style=""></span>';
                    d.style.display = 'block';
                } else {
                    d.style.display = 'none';
                }
            });
            setInterval(function () {
                if (true === checkOnlineStatus()) {
                    getBulletinCollection(document, null);
                    getLinksForLocalStorage();
                    console.log('Data updated');
                    IndexedDB.refreshData();
                  //  removeDataLocally();
                  //  loadDataIntoIndexedDB();
                }
            }, 60000);
        </script>
        <script>
            var db;
            var tables = ['tableBulletins', 'tableLinks'];
            const bulletinData = [
                { id: "00-01", name: "gopal", age: 35, email: "gopal@tutorialspoint.com" },
                { id: "00-02", name: "prasad", age: 32, email: "prasad@tutorialspoint.com" }
            ];

      var IndexedDB = (function(){

        var tablesData = [{ table: 'tableBulletins', data: bulletinData }, { table: 'tableLinks', data: linkData }];
        var tables = ['tableBulletins', 'tableLinks'];

        function indexedDBOk() {
            return "indexedDB" in window;
        }


        // document.addEventListener("DOMContentLoaded", function () {
        function initIndexedDB() {
            //No support? Go in the corner and pout.
            if (!indexedDBOk) return;

            var openRequest = indexedDB.open("MarketBulletins", 1);

            openRequest.onupgradeneeded = function (e) {

                var thisDB = e.target.result;

                for (var i = 0; i < tables.length; i++) {
                    if (!thisDB.objectStoreNames.contains(tables[i])) {
                        thisDB.createObjectStore(tables[i]);
                    }
                }
            }

            openRequest.onsuccess = function (e) {
                console.log("running onsuccess");

                db = e.target.result;
                addDataLocally(e);
            }

            openRequest.onerror = function (e) {
                //Do something for the error
                console.log('error occured', e.target.result)
            }
        }
        // }, false);

        function addDataLocally(e) {

            // var tablesData = [{ table: 'tableBulletins', data: bulletinData }, { table: 'tableLinks', data: linkData }];
            // var tables = ['tableBulletins', 'tableLinks'];

            var transaction = db.transaction(tables, "readwrite");
            for (var i = 0; i < tables.length; i++) {
                //var store = transaction.createObjectStore(tablesData[i].table, { keyPath: 'id' });

                var store = transaction.objectStore(tablesData[i].table);
                var data = tablesData[i].data;
                //Perform the add
                var request = store.add(data, 1);
            }

            request.onerror = function (e) {
                console.log("Error", e.target.error.name);
                //some type of error handler
            }

            request.onsuccess = function (e) {
                console.log("Data added to IndexedDB");
            }
        }

        function removeDataLocally() {

            // var tablesData = [{ table: 'tableBulletins', data: bulletinData }, { table: 'tableLinks', data: linkData }];
            // var tables = ['tableBulletins', 'tableLinks'];
            var transaction = db.transaction(tables, "readwrite");

            for (var i = 0; i < tables.length; i++) {

                var store = transaction.objectStore(tablesData[i].table);
                //Perform the add
                var request = store.clear();

                request.onsuccess = function (e) {
                    console.log('Data successfully removed!')
                }

                request.onerror = function (e) {
                    console.log('Error in remove data from IndexedDB!')
                }
            }

        }


        function refreshData(){

          removeDataLocally();
          initIndexDB();
          addDataLocally(e);
        }

        function getDataFromIndexedDB() {

          var transaction = db.transaction(tables, "readwrite");

          for (var i = 0; i < tables.length; i++) {

              var store = transaction.objectStore(tablesData[i].table);
              var request = store.getAll();

              request.onsuccess = function (e) {
                if (tablesData[i].table == 'tableBulletins'){
                  bulletinData =  e.target.result.value;
                }
                if (tablesData[i].table == 'tableLinks'){
                  linkData = e.target.result.value;
                }
                  console.log('Data successfully removed!')
              }

              request.onerror = function (e) {
                  console.log('Error in retrieve data from IndexedDB!')
              }
          }
      }

        return {
          refreshData: refreshData,
          getDataFromLocalDB: getDataFromIndexedDB
        }

      })()

        </script>
</body>

</html>
